# Нагрузочное тестирование
## Настройка тестовой среды

Для тестирования был настроен кластер из трёх узлов, развёрнутый в виртуальной машине и контейнерах, содержащихся в виртуальной машине.
Для создания виртуальной машины использовался Oracle VirtualBox. На виртуальную машину была установлена ОС Ubuntu LTE 16.04. Была насроено сетевое подключение между гостевой системой (Ubuntu LTE 16.04) и хостовой системой (Windows 10). Ещё два узла кластера запускались в linux контейнерах (LXC, использовались предоставленные образы ubuntu-daily:16.04). Для создания и настройки контейнеров было использовано руководство по LXC с официального сайта Ubuntu: https://linuxcontainers.org/lxd/getting-started-cli/.

Для запуска узлов кластера на виртуальной машине и на контейнере использовался предоставленый скрипт gradlew, но в качестве целевого приложения использовался не Cluster, а измененная версия класса Server, в которую передаётся топология созданого кластера:

```
final Set<String> topology = new HashSet<>(3);
topology.add("http://10.213.154.1:8080");
topology.add("http://10.213.154.185:8080");
topology.add("http://10.213.154.206:8080");
```

На скриншоте приведённом ниже показана конфигурация linux контейнеров и результаты ручного тестирования кластера с помощью telnet:
<img src="screenshots/container_setup_and_test.png">

## Smoke testing with curl

После настройки и первичного ручного тестирования кластерной конфигурации хранилища на виртуальной машине и контейнерах было проведено дымовое тестирования с помощью утилиты curl. Утилита curl запускалась из виртуальной машины с операционной системой Ubuntu, и запросы отправлялись на узел кластера, запущенный на этой виртуальной машине.

Сначала в цикле было создано 1000 entities с помощью запроса PUT:
```
$ for i in $(seq 0 1000); do time curl -X PUT -d value$i http://localhost:8080/v0/entity?id=key$i; done
```
Далее были проведены GET запросы на получение созданных entities:
```
$ for i in $(seq 0 1000); do time curl -X GET http://localhost:8080/v0/entity?id=key$i; done
```
Также было проведено тестирования запроса на удаление созданных entities:
```
$ for i in $(seq 0 1000); do time curl -X DELETE http://localhost:8080/v0/entity?id=key$i; done
```
И тестирования запроса к удалённым entities (повторный запуск цикла запросов GET).

Дымового тестирования, которое показало, что кластер работает корректно (корректно работают запросы GET, PUT, DELETE). Также с помощью утилиты time было оценено "на глаз" среднее время ответа кластера, которое составило ("на глаз") 35-40 мс.
